{% extends "layout.html" %}

{% block head %}
{{ super() }}
<script>
    $(document).ready(function() {
        retrieve_data();
    });
</script>
{% endblock %}

{% block content %}

<div class="btn-group" role="group" aria-label="...">
  <button type="button" class="filter btn btn-default" id='investigation'>Investigations</button>
  <button type="button" class="filter btn btn-default" id='conjecture'>Conjectures</button>
  <button type="button" class="filter btn btn-default" id='marker'>Markers</button>
</div>

<div class="container-fluid" id="videos"></div>


<script>
    $(".filter").on("click", function(e){
        var id_name = $(this).attr('id');
        retrieve_data(id_name);
    });
    
    function retrieve_data(endpoint, data){
        endpoint = typeof endpoint !== 'undefined' ? endpoint : 'investigation';
        data = typeof data !== 'undefined' ? data : '';
        url = "/api/" + endpoint;
        var req = new XMLHttpRequest();
        req.open("GET", url);
        req.setRequestHeader("Content-type", "application/json");
        req.onreadystatechange = function() {
            // if you got a good request:
            if(req.readyState == 4 && req.status == 200) {
                // the response is a JSON object. Parse it:
                responseJson = JSON.parse(req.responseText);
                display(responseJson);

                // $('#videos').text(JSON.stringify(responseJson));
            }
        }
        req.send(data);
    }

    function get_filter(){

    }


    function display(data){
        var display_objects = [];
        //build the display objects in the for loop
        //we can sort on the data objects attributes - date, day, time?
        for (obj_index in data.objects){
           obj = data.objects[obj_index]
           
           if ( obj.hasOwnProperty('question') ) {
               console.log(obj.id);
               div_id = "investigation"+JSON.stringify(obj.id);
               create_thumbnail_div(div_id);
               //$("#videos").append("<div id='"+div_id+"'></div>");
                //$("#"+div_id).append("<h4>"+obj.question+"</h4>");
                //for (recording in obj.schedule){
                //    console.log(obj.schedule[recording]);
                //    for (var i = 0; i < obj.schedule[recording].videos.length; i++) {
                //        var stub_url = "/video/stub/"+recording.videos[i].id;
                //        $("#videos").load(stub_url, function(){
                //            alert("load was performed.");
                //        });
                //    }
                //}
           }

           if ( obj.hasOwnProperty('conjecture') ) {
                console.log(obj.conjecture);
                //
           }
           if ( obj.hasOwnProperty('timestamp') ) {
                for (video in obj.videos){

                }
           }
        }
    }

    function create_thumbnail_div(div_id){
        $("#videos").append('<div class="row" id="'+div_id+'"></div>');
        $("#"+div_id).append("<h4>"+obj.question+"</h4>");
    }

</script>

{% endblock %}
