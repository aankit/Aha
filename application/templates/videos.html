{% extends "layout.html" %}

{% block head %}
{{ super() }}
<script>
    $(document).ready(function() {
        retrieve_data();
    });
</script>
{% endblock %}

{% block content %}

<div class="btn-group" role="group" aria-label="...">
  <button type="button" class="filter btn btn-default" id='investigation'>Investigations</button>
  <button type="button" class="filter btn btn-default" id='conjecture'>Conjectures</button>
  <button type="button" class="filter btn btn-default" id='marker'>Markers</button>
</div>

<div id="videos"></div>


<script>
    $(".filter").on("click", function(e){
        var id_name = $(this).attr('id');
        retrieve_data(id_name);
    });
    
    function retrieve_data(endpoint, data){
        endpoint = typeof endpoint !== 'undefined' ? endpoint : 'investigation';
        data = typeof data !== 'undefined' ? data : '';
        url = "/api/" + endpoint;
        var req = new XMLHttpRequest();
        req.open("GET", url);
        req.setRequestHeader("Content-type", "application/json");
        req.onreadystatechange = function() {
            // if you got a good request:
            if(req.readyState == 4 && req.status == 200) {
                // the response is a JSON object. Parse it:
                responseJson = JSON.parse(req.responseText);
                get_video_html(responseJson);

                // $('#videos').text(JSON.stringify(responseJson));
            }
        }
        req.send(data);
    }

    function get_filter(){

    }


    function get_video_html(data){
        console.log(data.objects);
        for (obj_index in data.objects){
           obj = data.objects[obj_index]
           
           if ( obj.hasOwnProperty('question') ) {
                $('#videos').html("<h4>"+obj.question+"</h4>");
                console.log(obj.question);
                for (recording in obj.schedule){
                    console.log(obj.schedule[recording]);
                }
                for (video in obj.videos) {
                    var stub_url = "/video/stub/"+video;
                    //url = '/';
                    $('#videos').load(stub_url, function(){
                     alert("load was performed.");
                    });
                }

           }

           if ( obj.hasOwnProperty('conjecture') ) {
                console.log(obj.conjecture);
                //
           }
           if ( obj.hasOwnProperty('timestamp') ) {
                console.log(obj.timestamp);
           }
        }
    }

</script>

{% endblock %}
